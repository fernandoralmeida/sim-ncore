@page
@model Sim.UI.Web.Areas.SimBI.Pages.Atendimentos.IndexModel

@{
    Layout = "_Layout.cshtml";
    ViewData["Title"] = "Power BI";
}

<partial name="_StatusMessage" model="Model.StatusMessage" />

<form method="post">
    <div class="row">
        <div  class="col s6 l3 m3 right">
            <div class="input-field valign-wrapper white z-depth-1 hoverable rounded-default pdn-h-8" style="margin:0px;">
                <input asp-for="Ano" />
                <button class="btn waves-effect waves-light submit"><i class="material-icons">refresh</i></button>
            </div>
        </div>
    </div>
</form>

<div class="row">

@if(Model.Atendimentos_List != null)
{    
        <div class="col s12 m9 l9 no-padding">
            <div class="col s6 m6 l6">
                <div class="card hoverable">
                    <div class="card-header grey-text">Atendimentos<i class="material-icons left">timelapse</i></div>
                    <h2 class="blue-text center pdn-b-4">@Model.Atendimentos_List.Cliente.Atendimentos</h2>
                    <div class="card-action font-size-12">
                        <div class="box-between" >
                            <div class="grey-text box-middle"><i class="tiny material-icons">person</i>@Model.Atendimentos_List.ClientePF.Atendimentos</div>
                            <div class="grey-text box-middle"><i class="tiny material-icons">business</i>@Model.Atendimentos_List.ClientePJ.Atendimentos</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col s6 m6 l6">
                <div class="card hoverable">
                    <div class="card-header grey-text">Serviços<i class="material-icons left">construction</i></div>
                    <div class="font-size-12 pdn-b-4 center">
                        <h2 class="light-green-text">@Model.Atendimentos_List.Cliente.Servicos</h2>
                    </div>
                    <div class="card-action font-size-12">
                        <div class="box-between">
                            <div class="grey-text box-middle"><i class="tiny material-icons">person</i>@Model.Atendimentos_List.ClientePF.Servicos</div>
                            <div class="grey-text box-middle"><i class="tiny material-icons">business</i>@Model.Atendimentos_List.ClientePJ.Servicos</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col s12 m12 l12">
                @if(Model.Atendimentos_List.ListaMensal != null)
                {
                    <div class="card hoverable">
                        <div class="card-header grey-text">Atendimentos nos meses<i class="material-icons left">calendar_month</i></div>
                        <div class="card-content no-padding" style="margin-top:9px;">
                            <div class="box-cell ">                            
                            @foreach(var m in Model.Atendimentos_List.ListaMensal)
                            {
                                <a class="box-cell-item font-size-12 modal-trigger" href="#viewmodal">
                                    <p class="grey-text lighten-2">@m.Mes</p>
                                    <p class="blue-text">@m.Atendimentos</p>
                                    <p class="green-text">@m.Servicos</p>
                                </a>
                            }
                            </div>
                        </div>
                    </div>               
                }
            </div>
        </div>
        <div class="col s12 m3 l3">            
                @if(Model.Atendimentos_List.ListaServicos != null)
                {
                    <div class="card medium hoverable" style="overflow-x:auto;">
                        <div class="card-header grey-text">Lista Serviços<i class="material-icons left">construction</i></div>
                        @foreach(var m in Model.Atendimentos_List.ListaServicos)
                        {
                            <div class="font-size-12 pdn-4 center">
                                <p class="grey-text lighten-2">@m.Servico</p>                                
                                <p class="light-green-text">@m.Quantidade</p>
                            </div>
                            <div class="divider"></div>
                        }
                    </div>
                }            
        </div>

}

@if(Model.Setores != null)
{
    <div id="divsetores" class="col s12 m9 l9 no-padding">        
        @foreach(var set in Model.Setores.Where(s => s.Cliente.Atendimentos > 0))
        { 
            <div class="col s12 m6 l6">           
                <div class="card hoverable">
                    <div class="card-header grey-text">@set.Cliente.Titulo<i class="material-icons left">keyboard_arrow_down</i></div>
                    
                    <div class="box-cell">
                        <a class="box-cell-item-flex font-size-12 modal-trigger"  href="#viewmodal">
                            <p class="grey-text"><i class="tiny material-icons">timelapse</i><h5 class="light-blue-text">@set.Cliente.Atendimentos</h5></p>
                            <div class="box-between" style="padding-right:20px; padding-left:20px;">
                                <div class="grey-text box-middle"><i class="tiny material-icons">person</i>@set.ClientePF.Atendimentos</div>
                                <div class="grey-text box-middle"><i class="tiny material-icons">business</i>@set.ClientePJ.Atendimentos</div>
                            </div>
                        </a>
                        <a class="box-cell-item-flex font-size-12 modal-trigger" href="#viewmodal">
                            <p class="grey-text"><i class="tiny material-icons">construction</i><h5 class="light-green-text">@set.Cliente.Servicos</h5></p>
                            <div class="box-between" style="padding-right:20px; padding-left:20px;">
                                <div class="grey-text box-middle"><i class="tiny material-icons">person</i>@set.ClientePF.Servicos</div>
                                <div class="grey-text box-middle"><i class="tiny material-icons">business</i>@set.ClientePJ.Servicos</div>
                            </div>
                        </a>
                    </div>
                    
                    <div class="card-content no-padding"> 
                    @if(set.ListaMensal != null)
                    {                
                        <div class="box-cell">                        
                            @foreach(var m in set.ListaMensal)
                            {
                                <a class="box-cell-item font-size-12 modal-trigger" href="#viewmodal">
                                    <p class="grey-text lighten-2">@m.Mes</p>
                                    <p class="blue-text">@m.Atendimentos</p>
                                    <p class="light-green-text">@m.Servicos</p>
                                </a>
                            }
                        </div>                                         
                    }
                    </div>
                </div>
            </div>
        }
    </div>    
}
    <div class="col s12 m3 l3">       
                @if (Model.AppUsers != null)
                {                
                    <div id="carduser" class="card hoverable" style="overflow-x:auto;">
                        <div class="card-header grey-text">Usuários<i class="material-icons left">account_circle</i></div>
                        @foreach(var m in Model.AppUsers.ListaAppUser)
                        {
                            <div class="font-size-12 center pdn-4">
                                <p class="grey-text lighten-2 font-size-12">@m.Nome</p>
                                <p class="blue-text font-size-14">@m.Atendimentos</p>
                            </div>
                            <div class="divider"></div>
                        }
                    </div>
                }  
    </div>

</div>


<!-- Modal Structure -->
<div id="viewmodal" class="modal modal-fixed-footer">
    <div class="modal-content">
        <ul class="collection showcollection"></ul>
    </div>
    <div class="modal-footer">
        <a href="#!" class="modal-close btn waves-effect">Fechar</a>
    </div>
</div>

<!-- Modal Structure Canal-->
<div id="viewmodalcanal" class="modal modal-fixed-footer">
    <div class="modal-content">
        <ul class="collection showcollectionCanal"></ul>
    </div>
    <div class="modal-footer">
        <a href="#!" class="modal-close btn waves-effect">Fechar</a>
    </div>
</div>

<!-- Modal Structure User-->
<div id="viewmodaluser" class="modal modal-fixed-footer">
    <div class="modal-content">
        <ul class="collection showcollectionUser"></ul>
    </div>
    <div class="modal-footer">
        <a href="#!" class="modal-close btn waves-effect">Fechar</a>
    </div>
</div>

@section scripts{
    <script>
        var divHeight = Number(document.getElementById('divsetores').offsetHeight - 24) + "px";
        document.getElementById("carduser").style.height = divHeight;     
        $(function () {
            $(".modal-trigger").click(function () {
                var param1 = $(this).data('id');
                var param2 = $(this).data('mth');
                var param3 = $(this).data('hdlr');
                var param4 = $(this).data('y');
                $(".showcollection").empty();
                $.getJSON(`/SimBI/Atendimentos?id=${param1}&mth=${param2}&y=${param4}&handler=${param3}`, (data) => {
                    var cor = "darken-1";
                    $.each(data, function (i, item) {
                        $(".showcollection").append(`<li class="collection-item"><span class="new badge green ${cor}" data-badge-caption="${item.value}"></span>${item.key}</li>`);
                        cor = "lighten-1";
                    });
                });
            });
            $(".modal-trigger").click(function () {
                var param1 = $(this).data('id');
                var param2 = $(this).data('id2');
                var param3 = $(this).data('mth');
                var param4 = $(this).data('hdlr');
                var param5 = $(this).data('y');
                $(".showcollectionCanal").empty();
                $.getJSON(`/SimBI/Atendimentos?id=${param1}&id2=${param2}&mth=${param3}&y=${param5}&handler=${param4}`, (data) => {
                    var cor = "blue";
                    $.each(data, function (i, item) {                        
                        $(".showcollectionCanal").append(`<li class="collection-item"><span class="new badge ${cor} lighten-1" data-badge-caption="${item.value}"></span>${item.key}</li>`);
                        cor = "green";
                    });
                });
            });
            $(".modal-trigger").click(function () {
                var param1 = $(this).data('id');
                var param2 = $(this).data('id2');
                var param3 = $(this).data('mth');
                var param4 = $(this).data('hdlr');
                var param5 = $(this).data('y');
                $(".showcollectionUser").empty();
                $.getJSON(`/SimBI/Atendimentos?id=${param1}&id2=${param2}&mth=${param3}&y=${param5}&handler=${param4}`, (data) => {
                    var cor = "blue";
                    $.each(data, function (i, item) {
                        $(".showcollectionUser").append(`<li class="collection-item"><span class="new badge ${cor} lighten-1" data-badge-caption="${item.value}"></span>${item.key}</li>`);
                        cor = "green";
                    });
                });
            });
        });
    </script>
}
