@page
@model Sim.UI.Web.Areas.SimBI.Pages.Atendimentos.IndexModel

@{
    Layout = "_Layout.cshtml";
    ViewData["Title"] = "Power BI";
}

<partial name="_StatusMessage" model="Model.StatusMessage" />

<form method="post">
    <div class="row centered">
        <div class="input-field col s12 l2 m6 valign-wrapper white z-depth-1 hoverable rounded-default">
            <input asp-for="Ano" />
            <button class="btn waves-effect waves-light" asp-page-handler="Month"><i class="material-icons">refresh</i></button>
        </div>
    </div>
</form>


<div class="row">

@if(Model.Atendimentos_List != null)
{
    
        <div class="col s12 m10 l10">
            <div class="col s6 m6 l6">
                <div class="card hoverable">
                    <div class="card-content center">
                        <h2 class="blue-text">@Model.Atendimentos_List.Cliente.Atendimentos</h2>
                        <div class="divider"></div>
                        <span class="orange-text left">@Model.Atendimentos_List.ClientePF.Atendimentos<i class="material-icons orange-text left">person</i></span>
                        <span class="purple-text right">@Model.Atendimentos_List.ClientePJ.Atendimentos<i class="material-icons purple-text left">factory</i></span>
                    </div>
                    <div class="card-action">
                        <span class="grey-text">Atendimentos</span>
                        <i class="material-icons blue-text right">timer</i>
                    </div>
                </div>
            </div>
            <div class="col s6 m6 l6">
                    <div class="card hoverable">
                    <div class="card-content center">
                        <h2 class="green-text">@Model.Atendimentos_List.Cliente.Servicos</h2>
                    </div>
                    <div class="card-action">
                        <span class="grey-text">Serviços</span>
                        <i class="material-icons green-text right">construction</i>
                    </div>
                </div>
            </div>
            <div class="col s12 m12 l12">
                    @if(Model.Atendimentos_List.ListaMensal != null)
                    {
                        <div class="card hoverable" style="overflow-x:auto;">
                        @foreach(var m in Model.Atendimentos_List.ListaMensal)
                        {
                            <div class="col s1 l1 m1 center font-size-12 pdn-4">
                                <p class="grey-text lighten-2">@m.Mes</p>
                                <p class="blue-text">@m.Atendimentos</p>
                                <p class="green-text">@m.Servicos</p>
                            </div>
                        }
                        </div>               
                    }
            </div>
        </div>
        <div class="col s12 m2 l2">
            <div class="col s12 m12 l12">
                @if(Model.Atendimentos_List.ListaServicos != null)
                {
                    <div class="card medium hoverable" style="overflow-x:auto;">
                        @foreach(var m in Model.Atendimentos_List.ListaServicos)
                        {
                            <div class="font-size-12 pdn-4">
                                <p class="grey-text lighten-2">@m.Servico</p>                                
                                <p class="green-text">@m.Quantidade</p>
                            </div>
                        }
                    </div>
                }
            </div>
        </div> 
    
}

@if(Model.Setores != null)
{
    <div class="col s12 m10 l10">        
        @foreach(var set in Model.Setores.Where(s => s.Cliente.Atendimentos > 0))
            {
               <div class="col s6 m6 l6">
                <div class="card hoverable">
                    <table class="striped">
                        <caption class="grey-text">@set.Cliente.Titulo</caption>
                             <thead class="grey-text darken-3">                                 
                                 <tr>
                                     <th>Atendimentos</th>
                                     <th>Serviços</th>
                                 </tr>
                             </thead>
                             <tbody class="grey-text darken-3">
                                 <tr>
                                     <td><h5><a href="#" class="blue-text">@set.Cliente.Atendimentos</a></h5></td>
                                     <td><h5><a href="#" class="green-text">@set.Cliente.Servicos</a></h5></td>                                     
                                 </tr>
                             </tbody>
                    </table>
                    @if(set.ListaMensal != null)
                    {
                        <div class="row center">
                            @foreach(var m in set.ListaMensal)
                            {
                                <div class="col s2 l2 m2 center font-size-12">
                                    <p class="grey-text lighten-2">@m.Mes</p>
                                    <p class="blue-text">@m.Atendimentos</p>
                                    <p class="green-text">@m.Servicos</p>
                                </div>
                            }
                        </div>                    
                    }
                </div>
               </div>
            }
    </div>    
}
    <div class="col s12 m2 l2">
        
            @if (Model.AppUsers != null)
            {
                <div class="col s12 m12 l12">
                    <div class="card medium hoverable" style="overflow-x:auto;">
                        @foreach(var m in Model.AppUsers.ListaAppUser)
                        {
                            <div class="font-size-12 pdn-4">
                                <p class="grey-text lighten-2 font-size-12">@m.Nome</p>
                                <p class="blue-text font-size-14">@m.Atendimentos</p>
                            </div>
                        }
                    </div>
                </div>
            }
        
    </div>
</div>


<!-- Modal Structure -->
<div id="viewmodal" class="modal modal-fixed-footer">
    <div class="modal-content">
        <ul class="collection showcollection"></ul>
    </div>
    <div class="modal-footer">
        <a href="#!" class="modal-close btn waves-effect">Fechar</a>
    </div>
</div>

<!-- Modal Structure Canal-->
<div id="viewmodalcanal" class="modal modal-fixed-footer">
    <div class="modal-content">
        <ul class="collection showcollectionCanal"></ul>
    </div>
    <div class="modal-footer">
        <a href="#!" class="modal-close btn waves-effect">Fechar</a>
    </div>
</div>

<!-- Modal Structure User-->
<div id="viewmodaluser" class="modal modal-fixed-footer">
    <div class="modal-content">
        <ul class="collection showcollectionUser"></ul>
    </div>
    <div class="modal-footer">
        <a href="#!" class="modal-close btn waves-effect">Fechar</a>
    </div>
</div>

@section scripts{
    <script>
        $(function () {
            $(".modal-trigger").click(function () {
                var param1 = $(this).data('id');
                var param2 = $(this).data('mth');
                var param3 = $(this).data('hdlr');
                var param4 = $(this).data('y');
                $(".showcollection").empty();
                $.getJSON(`/SimBI/Atendimentos?id=${param1}&mth=${param2}&y=${param4}&handler=${param3}`, (data) => {
                    var cor = "darken-1";
                    $.each(data, function (i, item) {
                        $(".showcollection").append(`<li class="collection-item"><span class="new badge green ${cor}" data-badge-caption="${item.value}"></span>${item.key}</li>`);
                        cor = "lighten-1";
                    });
                });
            });
            $(".modal-trigger").click(function () {
                var param1 = $(this).data('id');
                var param2 = $(this).data('id2');
                var param3 = $(this).data('mth');
                var param4 = $(this).data('hdlr');
                var param5 = $(this).data('y');
                $(".showcollectionCanal").empty();
                $.getJSON(`/SimBI/Atendimentos?id=${param1}&id2=${param2}&mth=${param3}&y=${param5}&handler=${param4}`, (data) => {
                    var cor = "blue";
                    $.each(data, function (i, item) {                        
                        $(".showcollectionCanal").append(`<li class="collection-item"><span class="new badge ${cor} lighten-1" data-badge-caption="${item.value}"></span>${item.key}</li>`);
                        cor = "green";
                    });
                });
            });
            $(".modal-trigger").click(function () {
                var param1 = $(this).data('id');
                var param2 = $(this).data('id2');
                var param3 = $(this).data('mth');
                var param4 = $(this).data('hdlr');
                var param5 = $(this).data('y');
                $(".showcollectionUser").empty();
                $.getJSON(`/SimBI/Atendimentos?id=${param1}&id2=${param2}&mth=${param3}&y=${param5}&handler=${param4}`, (data) => {
                    var cor = "blue";
                    $.each(data, function (i, item) {
                        $(".showcollectionUser").append(`<li class="collection-item"><span class="new badge ${cor} lighten-1" data-badge-caption="${item.value}"></span>${item.key}</li>`);
                        cor = "green";
                    });
                });
            });
        });
    </script>
}
