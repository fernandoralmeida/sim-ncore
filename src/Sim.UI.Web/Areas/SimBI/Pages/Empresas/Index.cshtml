@page "/bi/empresas/{m?}/"
@model Sim.UI.Web.Areas.SimBI.Pages.Empresas.IndexModel
@using Sim.UI.Web.Areas.SimBI.Pages.Empresas
@inject Sim.Application.Cnpj.Interfaces.IAppServiceCnpj appServiceCnpj;

@{
    Layout = "_Layout.cshtml";
    ViewData["Title"] = "Power BI";
    ViewData["BIActivePage"] = Sim.UI.Web.Areas.SimBI.Pages.Empresas.EmpNavPages.Empresa;
}

@{
    var municipios = await appServiceCnpj.DoListMicroRegiaoJahuAsync();
}
@{
    var nome = municipios.Where(n => n.Codigo.Contains(Model.Input.Municipio));
}
<ul id='dropdown1' class='dropdown-content'>
    @foreach (var item in municipios)
    {
        <li><a class="submit" asp-route-m="@item.Codigo" onclick="CloseDropdown()">@item.Descricao</a></li>
    }
</ul>
<ul id='mobile-demo' class='dropdown-content'>
    <li class="@EmpNavPages.EmpNavClass(ViewContext)"><a class="submit" asp-area="SimBI" asp-page="./Index"
            asp-route-m="@Model.Input.Municipio">Empresas</a></li>
    <li class="@EmpNavPages.CnaeNavClass(ViewContext)"><a class="submit" asp-area="SimBI" asp-page="./Cnaes"
            asp-route-m="@Model.Input.Municipio">Cnaes</a></li>
    <li class="@EmpNavPages.MappNavClass(ViewContext)"><a class="submit" asp-area="SimBI" asp-page="./Mapping"
            asp-route-m="@Model.Input.Municipio">Mapa</a></li>
    <li><a class='dropdown-trigger' href='#' data-target='dropdown1'><i
                class="material-icons">arrow_drop_down</i>@nome.SingleOrDefault().Descricao</a></li>
</ul>
<partial name="_StatusMessage" model="Model.StatusMessage" />
<form method="post">
    <nav class="row transparent">
        <div class="row nav-wrapper">
            <div class="input-field col s6 m6 l6 no-padding">
                <input id="search" placeholder="Digite aqui para pesquisar!" onkeypress="handle(event)"
                    asp-for="Input.Ano" type="search" required>
                <label class="label-icon" for="search"><i class="material-icons">search</i></label>
            </div>
            <a class='right dropdown-trigger hide-on-large-only' href='#' data-target='mobile-demo'><i
                    class="material-icons alpha-text-5">menu arrow_drop_down</i></a>
            <ul class="right hide-on-med-and-down">
                <li class="@EmpNavPages.EmpNavClass(ViewContext)"><a class="submit" asp-area="SimBI" asp-page="./Index"
                        asp-route-m="@Model.Input.Municipio">Empresas</a></li>
                <li class="@EmpNavPages.CnaeNavClass(ViewContext)"><a class="submit" asp-area="SimBI" asp-page="./Cnaes"
                        asp-route-m="@Model.Input.Municipio">Cnaes</a></li>
                <li class="@EmpNavPages.MappNavClass(ViewContext)"><a class="submit" asp-area="SimBI"
                        asp-page="./Mapping" asp-route-m="@Model.Input.Municipio">Mapa</a></li>
                <li><a class='dropdown-trigger' href='#' data-target='dropdown1'>@nome.SingleOrDefault().Descricao<i
                            class="material-icons right">arrow_drop_down</i></a></li>
            </ul>
        </div>
    </nav>
</form>

<div class="row">
    @foreach (var emp in Model.ListEmpresas)
    {
        <div class="row border-b font-size-12 mgn-h-2">
            <strong>@Model.Input.Ano</strong>
        </div>
        <div class="row">
            <div class="box-container-card">
                <div class="box-column-5">
                    <div class="box-column-row">
                        <div class="box-card">
                            <div class="card-header grey-text">Panorama Empresas Novas</div>
                            <div class="box-around">
                                @foreach (var ep in emp.EmpresasNovas)
                                {
                                    var _cor = "blue-text";
                                    if (@ep.item.ToLower() == "baixadas")
                                        _cor = "red-text";
                                    if (@ep.item.ToLower() == "nulas")
                                        _cor = "grey-text";
                                    if (@ep.item.ToLower() == "suspensas")
                                        _cor = "blue-grey-text";
                                    if (@ep.item.ToLower() == "inaptas")
                                        _cor = "orange-text";

                                    <a class="box-cell-item-flex font-size-12">
                                        <p class="grey-text">@ep.item</p>
                                        <p class="@_cor font-h6">@ep.value</p>
                                        <p class=" grey-text">(@ep.percent.ToString("N0")%)</p>
                                    </a>
                                }
                            </div>
                        </div>
                    </div>
                </div>
                <div class="box-column-2-5">
                    <div class="box-column-row">
                        <div class="box-card">
                            <div class="card-header grey-text">Porte</div>
                            <div class="box-around">
                                @foreach (var p in emp.PorteAnual)
                                {
                                    <div class="box-cell-item-flex font-size-12">
                                        <p class="grey-text">@p.item</p>
                                        <p class="blue-text font-h6">@p.value</p>
                                        <p class="grey-text">(@p.percent.ToString("N0")%)</p>
                                    </div>
                                }
                            </div>
                        </div>
                    </div>
                </div>
                <div class="box-column-2-5">
                    <div class="box-column-row">
                        <div class="box-card">
                            <div class="card-header grey-text">Fiscal</div>
                            <div class="box-around">
                                @foreach (var rf in emp.RFiscalAnual)
                                {
                                    <div class="box-cell-item-flex font-size-12">
                                        <p class="grey-text">@rf.item</p>
                                        <p class="blue-text font-h6">@rf.value</p>
                                        <p class="grey-text">(@rf.percent.ToString("N0")%)</p>
                                    </div>
                                }
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">            
            <div class="box-container-card">
                    <div class="box-column-2">
                        <div class="box-card">
                            <div class="box-around">
                                <a class="box-cell-item-flex font-size-12">
                                    <p class="grey-text">@emp.ComercioAnual.item</p>
                                    <p class="blue-text font-h6">@emp.ComercioAnual.value</p>
                                    <p class="grey-text">(@emp.ComercioAnual.percent.ToString("N0")%)</p>
                                </a>
                            </div>
                            <div class="box-card-action font-size-12">
                                @foreach (var sc in emp.SubComercioAnual)
                                {
                                    <p class="grey-text truncate mgn-b-0 mgn-t-0" title="@sc.item">(@sc.percent.ToString("N0")%) @sc.item</p>
                                }
                            </div>
                        </div>
                    </div>
                    <div class="box-column-2">
                        <div class="box-card">
                            <div class="box-around">
                                <a class="box-cell-item-flex font-size-12">
                                    <p class="grey-text">@emp.IndustriaAnual.item</p>
                                    <p class="blue-text font-h6">@emp.IndustriaAnual.value</p>
                                    <p class="grey-text">(@emp.IndustriaAnual.percent.ToString("N0")%)</p>
                                </a>
                            </div>
                            <div class="box-card-action font-size-12">
                                @foreach (var sc in emp.SubIndustriaAnual)
                                {
                                    <p class="grey-text truncate mgn-b-0 mgn-t-0" title="@sc.item">(@sc.percent.ToString("N0")%) @sc.item</p>
                                }
                            </div>
                        </div>
                    </div>
                    <div class="box-column-2">
                        <div class="box-card">
                            <div class="box-around">
                                <a class="box-cell-item-flex font-size-12">
                                    <p class="grey-text">@emp.ServicosAnual.item</p>
                                    <p class="blue-text font-h6">@emp.ServicosAnual.value</p>
                                    <p class="grey-text">(@emp.ServicosAnual.percent.ToString("N0")%)</p>
                                </a>
                            </div>
                            <div class="box-card-action font-size-12">
                                @foreach (var sc in emp.SubServicosAnual)
                                {
                                    <p class="grey-text truncate mgn-b-0 mgn-t-0" title="@sc.item">(@sc.percent.ToString("N0")%) @sc.item</p>
                                }
                            </div>
                        </div>
                    </div>
                    <div class="box-column-2">
                        <div class="box-card">
                            <div class="box-around">
                                <a class="box-cell-item-flex font-size-12">
                                    <p class="grey-text">@emp.ConstrucaoAnual.item</p>
                                    <p class="blue-text font-h6">@emp.ConstrucaoAnual.value</p>
                                    <p class="grey-text">(@emp.ConstrucaoAnual.percent.ToString("N0")%)</p>
                                </a>
                            </div>
                            <div class="box-card-action font-size-12">
                                @foreach (var sc in emp.SubConstrucaoAnual)
                                {
                                    <p class="grey-text truncate mgn-b-0 mgn-t-0" title="@sc.item">(@sc.percent.ToString("N0")%) @sc.item</p>
                                }
                            </div>
                        </div>
                    </div>
                    <div class="box-column-2">
                        <div class="box-card">
                            <div class="box-around">
                                <a class="box-cell-item-flex font-size-12">
                                    <p class="grey-text">@emp.AgroAnual.item</p>
                                    <p class="blue-text font-h6">@emp.AgroAnual.value</p>
                                    <p class="grey-text">(@emp.AgroAnual.percent.ToString("N0")%)</p>
                                </a>
                            </div>
                            <div class="box-card-action font-size-12">
                                @foreach (var sc in emp.SubAgroAnual)
                                {
                                    <p class="grey-text truncate mgn-b-0 mgn-t-0" title="@sc.item">(@sc.percent.ToString("N0")%) @sc.item</p>
                                }
                            </div>
                        </div>
                    </div>
            </div> 
        </div>
        <div class="row">
            <div class="box-container-card">
                <div class="box-column">
                    <div class="box-column-row">
                        <div class="box-card">
                            <div class="card-header grey-text">Novas Empresas</div>
                            <div class="box-around">
                                @foreach (var m in emp.FormalizadasMensal)
                                {
                                    <a class="box-cell-item-flex font-size-12">
                                        <p class="grey-text">@m.item</p>
                                        <p class="blue-text font-h6">@m.value</p>
                                        <p class="grey-text">(@m.percent.ToString("N0")%)</p>
                                    </a>
                                }
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
        <div class="row border-b font-size-12 mgn-h-2">
            <strong>Geral</strong>
        </div>
        <div class="row">
            <div class="box-container-card">
                <div class="box-column-8">


                    <div class="box-column-row">
                        <div class="box-card">
                            <div class="card-header grey-text">Empresas</div>
                            <div class="box-around">
                                @foreach (var ep in emp.Empresas)
                                {
                                    var _cor = "blue-text";
                                    if (@ep.item.ToLower() == "baixadas")
                                        _cor = "red-text";
                                    if (@ep.item.ToLower() == "nulas")
                                        _cor = "grey-text";
                                    if (@ep.item.ToLower() == "suspensas")
                                        _cor = "blue-grey-text";
                                    if (@ep.item.ToLower() == "inaptas")
                                        _cor = "orange-text";

                                    <a class="box-cell-item-flex font-size-12">
                                        <p class="grey-text">@ep.item</p>
                                        <p class="@_cor font-h6">@ep.value</p>
                                        <p class=" grey-text">(@ep.percent.ToString("N0")%)</p>
                                    </a>
                                }
                            </div>
                        </div>
                    </div>
                    <div class="box-column-row">
                        <div class="box-card">
                            <div class="card-header grey-text">Porte</div>
                            <div class="box-around">
                                @foreach (var p in emp.Porte)
                                {
                                    <div class="box-cell-item-flex font-size-12">
                                        <p class="grey-text">@p.item</p>
                                        <p class="blue-text font-h6">@p.value</p>
                                        <p class="grey-text">(@p.percent.ToString("N0")%)</p>
                                    </div>
                                }
                            </div>
                        </div>
                        <div class="box-card">
                            <div class="card-header grey-text">Fiscal</div>
                            <div class="box-around">
                                @foreach (var rf in emp.RFiscal)
                                {
                                    <div class="box-cell-item-flex font-size-12">
                                        <p class="grey-text">@rf.item</p>
                                        <p class="blue-text font-h6">@rf.value</p>
                                        <p class="grey-text">(@rf.percent.ToString("N0")%)</p>
                                    </div>
                                }
                            </div>
                        </div>
                    </div>
                    <div class="box-column-row">
                        <div class="box-card">
                            <div class="box-around">
                                <a class="box-cell-item-flex font-size-12">
                                    <p class="grey-text">@emp.Comercio.item</p>
                                    <p class="blue-text font-h6">@emp.Comercio.value</p>
                                    <p class="grey-text">(@emp.Comercio.percent.ToString("N0")%)</p>
                                </a>

                            </div>
                        </div>
                        <div class="box-card">
                            <div class="box-around">
                                <a class="box-cell-item-flex font-size-12">
                                    <p class="grey-text">@emp.Industria.item</p>
                                    <p class="blue-text font-h6">@emp.Industria.value</p>
                                    <p class="grey-text">(@emp.Industria.percent.ToString("N0")%)</p>
                                </a>
                            </div>
                        </div>
                        <div class="box-card">
                            <div class="box-around">
                                <a class="box-cell-item-flex font-size-12">
                                    <p class="grey-text">@emp.Servicos.item</p>
                                    <p class="blue-text font-h6">@emp.Servicos.value</p>
                                    <p class="grey-text">(@emp.Servicos.percent.ToString("N0")%)</p>
                                </a>
                            </div>
                        </div>
                        <div class="box-card">
                            <div class="box-around">
                                <a class="box-cell-item-flex font-size-12">
                                    <p class="grey-text">@emp.Construcao.item</p>
                                    <p class="blue-text font-h6">@emp.Construcao.value</p>
                                    <p class="grey-text">(@emp.Construcao.percent.ToString("N0")%)</p>
                                </a>
                            </div>
                        </div>
                        <div class="box-card">
                            <div class="box-around">
                                <a class="box-cell-item-flex font-size-12">
                                    <p class="grey-text">@emp.Agro.item</p>
                                    <p class="blue-text font-h6">@emp.Agro.value</p>
                                    <p class="grey-text">(@emp.Agro.percent.ToString("N0")%)</p>
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="box-column-row">
                        <div class="box-card">
                            <div class="card-header grey-text">Maturidade</div>
                            <div class="box-around">
                                @foreach (var rf in emp.Maturidade)
                                {
                                    <div class="box-cell-item-flex font-size-12">
                                        <p class="grey-text">@rf.item</p>
                                        <p class="blue-text font-h6">@rf.value</p>
                                        <p class="grey-text">(@rf.percent.ToString("N0")%)</p>
                                    </div>
                                }
                            </div>
                        </div>
                    </div>
                </div>
                <div class="box-column-2">
                    <div class="box-card" style="overflow-x:auto;">
                        <div class="card-header grey-text">Atividades</div>
                        @foreach (var c in emp.CnaesTop10)
                        {
                            <div class="font-size-12 pdn-h-4 grey-text">
                                <p class="truncate"><strong class="light-green-text">[@c.value]</strong> @c.item</p>
                            </div>
                            <div class="divider"></div>
                        }
                    </div>
                </div>
            </div>
        </div>
    }
</div>
<div class="row">
    <div class="font-size-12 truncate">
        <br />Informações extraidas da base de dados da RFB
        <br />Não contabilizam os CNPJs com CNAE principal da faixa "84 - ADMINISTRAÇÃO PÚBLICA, DEFESA E SEGURIDADE
        SOCIAL"
        <br />Não contabilizam os CNPJs com CNAE principal da faixa "94 - ATIVIDADES DE ORGANIZAÇÕES ASSOCIATIVAS"
    </div>
    <a href="" id="btn-export" class="light-blue-text pdn-v-10" title="Exportar"><i
            class="material-icons mgn-t-10">file_download</i></a>
</div>

@section scripts{
    <script>
        $(window).on('load', function () {
            var a = document.getElementById('btn-export');
            a.href = `/SimBI/Empresas/Export?municipio=${@Model.Input.Municipio}&handler=ExportData`;
        });
    </script>
}